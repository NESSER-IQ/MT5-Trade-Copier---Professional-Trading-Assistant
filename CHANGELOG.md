# سجل التغييرات - Changelog

## النسخة 2.0 - 2025-10-15

### ✨ ميزات جديدة (New Features)

#### 1. 🔐 تشفير بيانات الاعتماد
- إضافة نظام تشفير كامل لحماية بيانات Telegram و MT5
- استخدام تشفير Fernet (AES 128) لأمان عالي
- تحميل تلقائي للبيانات المحفوظة عند بدء البرنامج
- ملفات مشفرة:
  - `data/credentials.enc` - البيانات المشفرة
  - `data/.key` - مفتاح التشفير (مخفي)

#### 2. 📋 عرض جميع القنوات
- إضافة زر "عرض جميع القنوات" في تبويب القنوات
- عرض جميع القنوات والمجموعات المنضم لها على Telegram
- إمكانية إضافة/إزالة قنوات بنقرة واحدة
- عرض معلومات تفصيلية:
  - نوع القناة (قناة 📢 أو مجموعة 👥)
  - عدد الأعضاء
  - حالة المراقبة (✅ مراقبة / ⚪ غير مراقبة)

#### 3. 📨 تحسين قراءة الرسائل
- إضافة Debug Logging لتتبع الرسائل الواردة
- رسائل توضيحية في Console:
  - `📨 رسالة جديدة من chat_id: xxxxx`
  - `⚠️ لا توجد قنوات نشطة للمراقبة`
  - `⚠️ الرسالة من قناة غير مراقبة`
- تحسين معالجة القنوات النشطة
- تحسين التحقق من الاتصال

### 🐛 إصلاحات (Bug Fixes)

#### مشكلة: القنوات لا تستقبل إشارات
**الحل:**
- إصلاح معالج الرسائل (`message_handler`)
- التحقق الصحيح من القنوات النشطة
- إضافة رسائل تصحيح واضحة

#### مشكلة: جلسة Telegram غير مستقرة
**الحل:**
- استخدام مسار واضح للجلسة: `data/telegram_session.session`
- تحسين التحقق من الاتصال باستخدام `is_user_authorized()`
- معالجة أفضل للأخطاء مع رسائل واضحة

### 📁 ملفات جديدة

1. **encryption.py**
   - نظام التشفير الكامل
   - فئة `CredentialManager`
   - دوال التشفير وفك التشفير

2. **test_encryption.py**
   - اختبار شامل لنظام التشفير
   - 6 اختبارات مختلفة
   - تنظيف تلقائي للملفات

3. **NEW_FEATURES.md**
   - توثيق كامل للميزات الجديدة
   - أمثلة وشروحات مفصلة
   - استكشاف الأخطاء

4. **CHANGELOG.md**
   - هذا الملف
   - سجل جميع التغييرات

### 🔄 ملفات معدلة

#### telegram_client.py
```python
# إضافات جديدة:
+ async def get_all_joined_channels() -> List[Dict]
+ async def add_channel_by_id(channel_id, channel_name, username)

# تحسينات:
* تحسين message_handler() - رسائل تصحيح
* تحسين start() - اتصال أفضل وأكثر استقراراً
* تحسين معالجة القنوات النشطة
```

#### main_gui.py
```python
# إضافات جديدة:
+ from encryption import CredentialManager
+ self.credential_manager = CredentialManager()
+ def load_saved_credentials()
+ def show_all_channels()
+ def load_all_channels(scroll_frame)
+ def display_all_channels(scroll_frame, channels)
+ def create_selectable_channel_card(parent, channel)
+ def add_channel_by_id_and_refresh()
+ def remove_channel_and_refresh()

# تحسينات:
* تحديث save_settings() - حفظ مشفر
* إضافة زر "عرض جميع القنوات"
* تحميل تلقائي للبيانات المحفوظة
```

#### requirements.txt
```diff
+ cryptography
```

#### check_setup.py
```diff
+ ('cryptography', 'cryptography'),
```

### 📦 تحديثات المكتبات

```bash
# مكتبة جديدة
pip install cryptography
```

### 🚀 كيفية الترقية

#### من النسخة السابقة:

1. **تثبيت المكتبة الجديدة:**
   ```bash
   pip install cryptography
   ```

2. **تحديث الملفات:**
   - استبدل `telegram_client.py`
   - استبدل `main_gui.py`
   - أضف `encryption.py`

3. **أول تشغيل بعد الترقية:**
   - ستحتاج لإعادة إدخال بيانات الاتصال
   - اضغط "حفظ الإعدادات" لتشفيرها
   - من المرة القادمة ستُحمّل تلقائياً

#### تثبيت جديد:

```bash
# 1. تثبيت المكتبات
install.bat

# 2. فحص الإعداد
check_setup.bat

# 3. إنشاء ملف .env
copy .env.example .env
notepad .env

# 4. تشغيل البرنامج
run.bat
```

### ⚠️ ملاحظات مهمة

1. **مفتاح التشفير:**
   - لا تحذف ملف `data/.key` أبداً
   - بدونه لن تتمكن من قراءة بياناتك
   - احتفظ بنسخة احتياطية من مجلد `data`

2. **الأمان:**
   - البيانات محمية بتشفير AES 128
   - لا تشارك ملف `.key` مع أحد
   - لا تشارك ملف `credentials.enc` مع أحد

3. **الترحيل:**
   - إذا كنت تنقل البرنامج لجهاز آخر:
     - انسخ مجلد `data` كاملاً
     - أو أعد إدخال البيانات وحفظها

### 🔍 اختبارات

#### اختبار نظام التشفير:
```bash
python test_encryption.py
```

**النتيجة المتوقعة:**
```
✅ جميع الاختبارات نجحت!
```

#### اختبار الإعداد:
```bash
check_setup.bat
```

**النتيجة المتوقعة:**
```
✅ نسخة Python مناسبة
✅ customtkinter
✅ Telethon
✅ MetaTrader5
✅ python-dotenv
✅ matplotlib
✅ cryptography  ← جديد!
```

### 📊 الإحصائيات

| المقياس | القيمة |
|---------|--------|
| ملفات جديدة | 4 |
| ملفات معدلة | 4 |
| دوال جديدة | 12+ |
| أسطر كود مضافة | 500+ |
| اختبارات | 6 |

### 🎯 التحسينات المستقبلية المقترحة

1. ✅ تشفير البيانات - **مكتمل**
2. ✅ عرض جميع القنوات - **مكتمل**
3. ✅ تحسين قراءة الرسائل - **مكتمل**
4. ⏳ إضافة أنماط رسائل مخصصة
5. ⏳ تصدير السجلات
6. ⏳ إحصائيات متقدمة
7. ⏳ إشعارات سطح المكتب
8. ⏳ واجهة ويب اختيارية

### 🐛 مشاكل معروفة

لا توجد مشاكل معروفة في هذه النسخة.

### 💬 التغذية الراجعة

إذا واجهت أي مشاكل أو لديك اقتراحات:
1. راجع [README_AR.md](README_AR.md)
2. راجع [NEW_FEATURES.md](NEW_FEATURES.md)
3. راجع [QUICK_FIX.md](QUICK_FIX.md)

### 📜 الترخيص

هذا البرنامج للاستخدام الشخصي والتعليمي.

---

## النسخة 1.0 - الإصدار الأولي

### الميزات الأساسية
- ✅ الاتصال بـ Telegram
- ✅ الاتصال بـ MT5
- ✅ إضافة قنوات يدوياً
- ✅ تحليل الإشارات
- ✅ تنفيذ الصفقات
- ✅ لوحة التحكم
- ✅ الإحصائيات

---

**تم التطوير بواسطة Claude Code** 🤖

**للمزيد من المعلومات:**
- [README_AR.md](README_AR.md) - الدليل الكامل
- [NEW_FEATURES.md](NEW_FEATURES.md) - الميزات الجديدة بالتفصيل
- [QUICK_FIX.md](QUICK_FIX.md) - حلول سريعة

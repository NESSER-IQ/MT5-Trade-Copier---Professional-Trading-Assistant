# دليل التثبيت والتشغيل - Telegram MT5 Bot v2.0

## 🎯 نظرة عامة

هذا الإصدار المحدّث (v2.0) يتضمن:
- ✅ إصلاحات شاملة لمحلل الإشارات
- ✅ نظام تقارير يومية متقدم
- ✅ تصفية ذكية للرسائل غير المفيدة
- ✅ واجهة محسّنة بدون تجميد
- ✅ معالجة أخطاء محسّنة مع إشعارات

---

## 📋 المتطلبات

### 1. البرامج المطلوبة
- Python 3.8 أو أحدث
- MetaTrader 5 Terminal
- حساب Telegram

### 2. المكتبات المطلوبة

```bash
pip install -r requirements.txt
```

أو تثبيت يدوي:
```bash
pip install MetaTrader5
pip install telethon
pip install customtkinter
pip install cryptography
pip install matplotlib
```

---

## 🚀 التثبيت

### الخطوة 1: تحميل المشروع

```bash
cd "C:\Users\aliTe\Claud-MCP\Desktop\Telegramt"
```

### الخطوة 2: إنشاء المجلدات المطلوبة

البرنامج سينشئها تلقائياً، لكن يمكنك إنشائها يدوياً:

```bash
mkdir data
mkdir data\daily_reports
mkdir data\daily_reports\signals
mkdir data\daily_reports\trades
mkdir data\daily_reports\summary
```

### الخطوة 3: الحصول على API Credentials من Telegram

1. افتح https://my.telegram.org
2. سجل الدخول برقم هاتفك
3. اذهب إلى "API Development Tools"
4. أنشئ تطبيق جديد
5. احفظ `API ID` و `API Hash`

### الخطوة 4: تشغيل البرنامج

```bash
python main_gui.py
```

---

## ⚙️ الإعداد الأولي

### 1. إعدادات Telegram

في تبويب "الإعدادات":
1. أدخل `API ID`
2. أدخل `API Hash`
3. أدخل رقم الهاتف (مثال: +201234567890)
4. اضغط "الاتصال بالتليجرام"
5. أدخل الكود المرسل لهاتفك

### 2. إعدادات MT5

**الطريقة الموصى بها (تلقائي):**
1. افتح MetaTrader 5
2. سجل دخول في حسابك
3. في البرنامج، اضغط "🔄 اتصال تلقائي (موصى به)"
4. ✅ سيكتشف البرنامج الحساب تلقائياً

**الطريقة اليدوية:**
1. أدخل رقم الحساب
2. أدخل كلمة المرور
3. أدخل اسم الخادم
4. اضغط "الاتصال اليدوي"

### 3. إعدادات التداول

1. حدد حجم اللوت الافتراضي (مثال: 0.01)
2. فعّل "التداول التلقائي" إذا أردت تنفيذ الإشارات تلقائياً
3. اضغط "حفظ الإعدادات"

### 4. إضافة القنوات

**طريقة 1 - إضافة يدوية:**
1. اذهب إلى تبويب "القنوات"
2. أدخل رابط القناة أو @username
3. اضغط "إضافة"

**طريقة 2 - إضافة جماعية (موصى بها):**
1. اضغط "عرض جميع القنوات"
2. سترى قائمة بكل القنوات المنضم لها
3. حدد القنوات المطلوبة
4. اضغط "➕ إضافة المحددة"

---

## 🧪 اختبار التثبيت

### اختبار سريع

```bash
python test_fixes.py
```

يجب أن ترى:
- ✅ جميع اختبارات محلل الإشارات ناجحة
- ✅ جميع اختبارات نظام التقارير ناجحة
- ✅ جميع اختبارات تصفية الرسائل ناجحة

### اختبار يدوي

1. أرسل رسالة اختبار في أحد القنوات:
```
XAUUSD BUY 2050
TP 2055
TP 2060
SL 2045
```

2. تحقق من:
   - ظهور الإشارة في تبويب "📨 الرسائل الحية"
   - ظهور الإشارة في تبويب "الإشارات"
   - (إذا كان التداول التلقائي مفعل) تنفيذ الصفقة في MT5

---

## 📊 استخدام التقارير اليومية

### عرض التقارير

التقارير تُحفظ تلقائياً في:
```
data/daily_reports/
```

### أنواع التقارير

1. **تقرير الإشارات** (`signals/YYYY-MM-DD.json`):
   - جميع الإشارات المستلمة
   - إحصائيات لكل قناة
   - الرموز الأكثر تداولاً

2. **تقرير الصفقات** (`trades/YYYY-MM-DD.json`):
   - جميع الصفقات المنفذة
   - الأرباح والخسائر
   - معدل النجاح

3. **الملخص الشامل** (`summary/YYYY-MM-DD.json`):
   - ملخص اليوم كامل
   - أداء كل قناة
   - إحصائيات شاملة

### تصدير إلى Excel

الملفات CSV تُنشأ تلقائياً:
```
data/daily_reports/signals_YYYY-MM-DD.csv
data/daily_reports/trades_YYYY-MM-DD.csv
```

يمكنك فتحها في Excel أو Google Sheets.

---

## 🔧 حل المشاكل الشائعة

### مشكلة: "فشل الاتصال بالتليجرام"

**الحل:**
1. تأكد من صحة API ID و API Hash
2. تأكد من رقم الهاتف بالصيغة الدولية (+201234567890)
3. تحقق من اتصال الإنترنت
4. حاول حذف ملف `data/telegram_session.session` وإعادة المحاولة

### مشكلة: "فشل الاتصال التلقائي بـ MT5"

**الحل:**
1. تأكد من أن MT5 مفتوح
2. تأكد من تسجيل الدخول في MT5
3. استخدم الاتصال اليدوي بدلاً من التلقائي
4. راجع [MT5_TROUBLESHOOTING.md](MT5_TROUBLESHOOTING.md)

### مشكلة: "الإشارات تُرفض دائماً"

**الحل:**
1. راجع السجل (Console) لمعرفة سبب الرفض
2. تأكد من أن الرسائل تحتوي على:
   - رمز الأصل (GOLD, XAUUSD, BTC, ...)
   - نوع الصفقة (BUY/SELL)
   - أهداف الربح (TP)
   - وقف الخسارة (SL)
3. الأسعار يجب أن تكون منطقية:
   - للشراء: TP > Entry > SL
   - للبيع: TP < Entry < SL

### مشكلة: "الواجهة تتجمد"

**الحل:**
هذه المشكلة تم حلها في v2.0:
- جميع العمليات الطويلة في threads منفصلة
- إذا استمرت المشكلة، أعد تشغيل البرنامج

### مشكلة: "لا تظهر التقارير"

**الحل:**
1. تحقق من وجود المجلدات:
```bash
dir data\daily_reports
```

2. إنشاء تقرير يدوي:
```python
from daily_report_manager import DailyReportManager
manager = DailyReportManager()
summary = manager.generate_daily_summary()
```

---

## 📝 نصائح للاستخدام الأمثل

### 1. اختيار القنوات

- ✅ ابدأ بـ 3-5 قنوات موثوقة
- ✅ راقب أداءها في التقارير اليومية
- ✅ عطّل القنوات ضعيفة الأداء
- ❌ لا تضف أكثر من 20 قناة (لتجنب الإشارات المتضاربة)

### 2. إدارة المخاطر

- ✅ استخدم lot size صغير في البداية (0.01)
- ✅ راجع كل صفقة قبل التنفيذ إذا كنت مبتدئاً
- ✅ عطّل التداول التلقائي في الأخبار الهامة
- ❌ لا تخاطر بأكثر من 2% من رأس المال في صفقة واحدة

### 3. مراجعة التقارير

- راجع التقارير اليومية كل مساء
- قارن أداء القنوات المختلفة
- احتفظ بسجل للقنوات الأفضل أداءً
- اضبط الإعدادات بناءً على النتائج

### 4. الصيانة

- احذف التقارير القديمة يدوياً إذا امتلأت المساحة
- راجع سجل الأخطاء بانتظام
- حدّث البرنامج عند توفر إصدار جديد

---

## 🔐 الأمان

### بيانات الاعتماد

- جميع بيانات الاعتماد مُشفرة في `data/credentials.enc`
- لا تشارك هذا الملف مع أحد
- احتفظ بنسخة احتياطية آمنة

### النسخ الاحتياطي

قم بعمل نسخة احتياطية من:
```
data/credentials.enc
data/telegram_session.session
data/channels.json
data/daily_reports/
```

---

## 📞 الدعم

### للأسئلة والمساعدة:

1. راجع [FIXES_AND_IMPROVEMENTS.md](FIXES_AND_IMPROVEMENTS.md)
2. راجع [MT5_TROUBLESHOOTING.md](MT5_TROUBLESHOOTING.md)
3. تحقق من السجل (Console) للأخطاء
4. شغّل `test_fixes.py` للتشخيص

---

## 📜 الترخيص

هذا المشروع للاستخدام الشخصي فقط.
استخدمه على مسؤوليتك الخاصة.

---

## ✨ الميزات الجديدة في v2.0

- ✅ تصفية ذكية للأسعار حسب نوع الأصل
- ✅ رفض صارم للإشارات غير الصحيحة
- ✅ نظام تقارير يومية شامل
- ✅ تصفية الرسائل غير المفيدة
- ✅ إشعارات للمستخدم عند الأخطاء
- ✅ واجهة محسّنة بدون تجميد
- ✅ حفظ تلقائي للتقارير كل 24 ساعة
- ✅ تصدير تلقائي إلى CSV
- ✅ حذف تلقائي للتقارير القديمة

---

**إصدار:** 2.0
**تاريخ التحديث:** 2025-10-16
**الحالة:** ✅ جاهز للإنتاج

# ناسخ إشارات التليجرام إلى MetaTrader 5

نظام متكامل لنسخ إشارات التداول من قنوات التليجرام إلى منصة MetaTrader 5 تلقائياً مع واجهة رسومية احترافية.

## المميزات الرئيسية

### 1. محلل إشارات ذكي
- دعم أكثر من 15 نمط مختلف من رسائل الإشارات
- التعرف التلقائي على:
  - رمز الأصل (XAUUSD, BTCUSD, EURUSD, إلخ)
  - نوع الصفقة (شراء/بيع)
  - نقاط الدخول (سعر واحد أو نطاق سعري)
  - مستويات أخذ الربح (حتى 10 مستويات)
  - وقف الخسارة
- التحقق التلقائي من صحة البيانات

### 2. نظام Trailing Stop متقدم
- تحريك وقف الخسارة تلقائياً:
  - عند الوصول إلى TP1: نقل SL إلى نقطة الدخول (تأمين الصفقة)
  - عند الوصول إلى TP2: نقل SL إلى TP1
  - وهكذا حتى إغلاق الصفقة عند آخر TP
- عمل مستمر في الخلفية
- متابعة جميع الصفقات المفتوحة

### 3. واجهة رسومية احترافية
- **لوحة التحكم**: عرض الإحصائيات والرسومات البيانية
- **إدارة القنوات**: إضافة/حذف/تفعيل القنوات
- **متابعة الإشارات**: عرض جميع الإشارات المستلمة
- **الصفقات المفتوحة**: متابعة حية للصفقات
- **الإعدادات**: تكوين التليجرام وMT5

### 4. حفظ وتصدير البيانات
- حفظ تلقائي لجميع الإشارات المستلمة
- تصدير إلى CSV أو JSON
- سجل كامل للصفقات

### 5. أمان وموثوقية
- التحقق من صحة الإشارات قبل التنفيذ
- عدم فتح صفقة بدون SL و TP
- حماية من الإشارات الخاطئة

## متطلبات التشغيل

### البرامج المطلوبة
1. Python 3.8 أو أحدث
2. MetaTrader 5
3. حساب Telegram API (API ID و API Hash)

### المكتبات المطلوبة
```bash
pip install -r requirements.txt
```

المكتبات:
- telethon: للاتصال بالتليجرام
- MetaTrader5: للاتصال بمنصة MT5
- customtkinter: للواجهة الرسومية
- matplotlib: للرسومات البيانية
- pandas: لمعالجة البيانات

## إعداد البرنامج

### 1. الحصول على Telegram API

1. اذهب إلى https://my.telegram.org
2. سجل دخولك برقم هاتفك
3. اذهب إلى "API Development Tools"
4. أنشئ تطبيق جديد
5. احفظ `api_id` و `api_hash`

### 2. إعداد MT5

1. قم بتثبيت MetaTrader 5
2. افتح حساب تجريبي أو حقيقي
3. احفظ:
   - رقم الحساب
   - كلمة المرور
   - اسم الخادم (Server)

### 3. إعداد ملف البيئة

1. انسخ `.env.example` إلى `.env`
2. املأ البيانات:

```env
# Telegram API Configuration
API_ID=your_api_id
API_HASH=your_api_hash
PHONE_NUMBER=+1234567890

# MT5 Configuration
MT5_LOGIN=12345678
MT5_PASSWORD=your_password
MT5_SERVER=MetaQuotes-Demo
```

## تشغيل البرنامج

```bash
python main_gui.py
```

## استخدام البرنامج

### 1. الاتصال بالتليجرام وMT5

1. افتح تبويب **الإعدادات**
2. أدخل بيانات التليجرام
3. اضغط **الاتصال بالتليجرام**
4. أدخل كود التحقق عند الطلب
5. أدخل بيانات MT5
6. اضغط **الاتصال بـ MT5**

### 2. إضافة قنوات التليجرام

1. افتح تبويب **القنوات**
2. أدخل رابط القناة أو @username
3. اضغط **إضافة**
4. ستظهر القناة في القائمة مع حالتها

### 3. متابعة الإشارات

1. افتح تبويب **الإشارات**
2. ستظهر جميع الإشارات المستلمة
3. يمكنك تصدير الإشارات إلى CSV أو JSON

### 4. متابعة الصفقات

1. افتح تبويب **الصفقات المفتوحة**
2. ستظهر جميع الصفقات الحالية
3. يمكنك متابعة الأرباح/الخسائر الحالية

### 5. لوحة التحكم

- عرض إحصائيات اليوم
- عدد الصفقات
- الأرباح
- معدل النجاح
- القنوات النشطة
- رسم بياني للأرباح

## أنماط الرسائل المدعومة

البرنامج يدعم جميع الأنماط التي قدمتها في الأمثلة:

### نمط 1: البسيط
```
BTCUSD buy NOW 117200
TP 117500
TP 117700
TP 117900
SL 116700
```

### نمط 2: مع نطاق دخول
```
GOLD sell NOW 3343 - 45
TP 3340
TP 3337
TP 3333
SL 3351
```

### نمط 3: مع رموز تعبيرية
```
🔵XAUUSD_GOLD BUY 3331
🔳TP : 3335.00
🔳TP : 3338.00
🔳TP : 3343.00
❌SL : 3321.000
```

### نمط 4: مع أرقام TP
```
XAUUSD BUY 3330
TP¹ 3333
TP² 3336
TP³ 3339
TP⁴ 3342
SL 3310
```

### نمط 5: مع نطاق سعري للدخول
```
XAUUSD BUY NOW
Price Open @ 3333- 3330
Take profit 1 🔼@ 3337
Take profit 2 🔼@ 3342
Take profit 3 🔼@ 3350
➕Stop loss @ 3325
```

وأنماط أخرى كثيرة...

## إضافة أنماط مخصصة

يمكنك إضافة أنماط رسائل مخصصة من خلال:

1. تبويب **أنماط الرسائل**
2. إضافة النمط الخاص بك
3. البرنامج سيتعرف عليه تلقائياً

أو تعديل ملف `signal_parser.py` مباشرة.

## إعدادات التداول

### حجم اللوت
- يمكنك تعيين حجم اللوت الافتراضي
- يُنصح بالبدء بـ 0.01 للحسابات الصغيرة

### التداول التلقائي
- يمكنك تفعيل/تعطيل التداول التلقائي
- عند التفعيل: تُنفذ الإشارات تلقائياً
- عند التعطيل: تُحفظ الإشارات فقط

## نظام Trailing Stop

### كيف يعمل؟

1. **عند فتح الصفقة**: يتم تعيين SL الأصلي
2. **عند الوصول لـ TP1**: ينتقل SL إلى نقطة الدخول (Break Even)
3. **عند الوصول لـ TP2**: ينتقل SL إلى TP1
4. **عند الوصول لـ TP3**: ينتقل SL إلى TP2
5. **وهكذا**: حتى الوصول لآخر TP أو ضرب SL

### مثال عملي

صفقة شراء XAUUSD:
- **الدخول**: 3330
- **TP1**: 3335 / **TP2**: 3340 / **TP3**: 3345
- **SL الأصلي**: 3320

**التنفيذ**:
1. السعر وصل 3335 → SL ينتقل إلى 3330 (الدخول)
2. السعر وصل 3340 → SL ينتقل إلى 3335 (TP1)
3. السعر وصل 3345 → تُغلق الصفقة بربح كامل

## هيكل الملفات

```
Telegramt/
├── main_gui.py              # الواجهة الرسومية الرئيسية
├── signal_parser.py         # محلل الإشارات
├── telegram_client.py       # عميل التليجرام
├── mt5_manager.py          # مدير MT5 والصفقات
├── config.py               # ملف الإعدادات
├── requirements.txt        # المكتبات المطلوبة
├── .env.example           # مثال ملف البيئة
├── README.md              # هذا الملف
└── data/                  # مجلد البيانات
    ├── channels.json      # القنوات المحفوظة
    ├── signals_history.json  # سجل الإشارات
    ├── trades.json        # سجل الصفقات
    └── settings.json      # الإعدادات
```

## الأمان

### ⚠️ تحذيرات هامة

1. **لا تشارك ملف `.env` أبداً** - يحتوي على بياناتك الحساسة
2. **ابدأ بحساب تجريبي** - اختبر البرنامج أولاً
3. **استخدم أحجام لوت صغيرة** - خاصة في البداية
4. **راقب الصفقات** - لا تترك البرنامج دون مراقبة
5. **تحقق من الإشارات** - قبل الاعتماد الكلي على القنوات

### حماية البيانات

- جميع البيانات تُحفظ محلياً
- لا يتم إرسال أي بيانات إلى خوادم خارجية
- اتصالك بالتليجرام وMT5 مشفر

## استكشاف الأخطاء

### مشكلة: فشل الاتصال بالتليجرام
- تأكد من صحة API ID و API Hash
- تأكد من صحة رقم الهاتف (بصيغة دولية)
- تحقق من اتصالك بالإنترنت

### مشكلة: فشل الاتصال بـ MT5
- تأكد من تثبيت MT5 بشكل صحيح
- تأكد من صحة بيانات الحساب
- تأكد من أن MT5 يعمل في الخلفية

### مشكلة: لا يتم تنفيذ الصفقات
- تحقق من تفعيل "التداول التلقائي"
- تأكد من وجود رصيد كافٍ
- تحقق من أن الرمز متاح في MT5

### مشكلة: لا يتم التعرف على الإشارات
- تحقق من تنسيق الرسالة
- تأكد من وجود TP و SL
- جرب إضافة نمط مخصص

## التطوير المستقبلي

- [ ] دعم المزيد من أنماط الرسائل
- [ ] إشعارات Telegram عند تنفيذ الصفقات
- [ ] نظام إدارة مخاطر متقدم
- [ ] دعم حسابات MT5 متعددة
- [ ] تحليل أداء القنوات
- [ ] واجهة ويب

## الدعم

إذا واجهت أي مشكلة:

1. تحقق من قسم "استكشاف الأخطاء"
2. راجع ملف السجل في مجلد `data/`
3. تأكد من تحديث جميع المكتبات

## الترخيص

هذا المشروع مفتوح المصدر للاستخدام الشخصي.

## إخلاء المسؤولية

⚠️ **تحذير**: التداول في الأسواق المالية ينطوي على مخاطر عالية. استخدم هذا البرنامج على مسؤوليتك الخاصة. المطور غير مسؤول عن أي خسائر مالية.

---

**نتمنى لك تداولاً موفقاً! 📈**
